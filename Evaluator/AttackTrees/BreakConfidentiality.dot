graph {
#attributes
splines=polyline;
compound=true;
node [shape=box];

#legend
# "node_name" [label appearing after the rendering] /*hooks for the highlighting process*/
# NOTE: each highlight-able line must end with a slash (without a space following)

#################Confidentiality Nodes#################
##----------Parents---------
"conf_msg_C" [label = "Break\nmessage confidentiality"][penwidth=4] /* 3SHAKE HSTS_not_preloaded DROWN */
"conf_tls_hshake" [label = "Exploit\nHandshake protocol"][penwidth=2] /* 3SHAKE HSTS_not_preloaded DROWN */

"conf_legacy" [label = "Exploit backward\ncompatibility"] /* DROWN */
"conf_sniffing" [label = "Passive Sniffing"]/* DROWN */

"conf_mitm" [label = "MITM"] /* 3SHAKE HSTS_not_preloaded */

##----------Leaves----------
"conf_drown_1" [label = "- RSA-generated session key\l\n- SSLv2 available on the target server\lOR\n- Same private key used by a parallel server that\l    supports SSLv2\l"][color=chocolate]
"conf_drown_2" [label = "1. Sniff packets autonomously generated by the victim\lOR\n1. Sniff packets generated through a controlled\l     JavaScript (within the victim's browser)\l\n2. Repeatedly initiate SSLv2 connections using\l    (export-grade) RSA and a peculiar ClientMasterKey\l3. Bruteforce server's responses to leak information\l4. Exploit the server's response to recover the\l     MasterSecret\l5. Use the MasterSecret to decrypt the transmission\l"][color=deepskyblue2]

"conf_3shake_1" [label = "- Renegotiation available\l- Resumption available\l- RSA key exchange negotiated\l"][color=chocolate]
"conf_3shake_2" [label = "1. Wait for a client-initiated handshake\l2. Connect to the server (sharing the\l     parameters, different tls-unique)\l3. Wait for a session resumption by the\l     client\l4. Resume the connection to the server\l     (same tls-unique)\l5. Optionally inject a malicious request\l6. Trigger the server to request a client\l     certificate\l7. Forward client's handshake messages\l     to the server\l8. Snoop the connection exploiting\l     the same origin policy\l"][color=deepskyblue2]

"conf_stripping_1" [label = "- HSTS not preloaded\l"][color=chocolate]
"conf_stripping_2" [label = "1. Start an ARP spoofing against\l     the victim\l2. Edit victim's destination address\l     (of the packets) by forcing the\l     unsecure version of the website\l3. Snoop the unencrypted messages\l"][color=deepskyblue2]

#-----------Edges-----------
## root
	"conf_msg_C" -- "conf_tls_hshake" /* 3SHAKE HSTS_not_preloaded DROWN */

### handshake subtree
	"conf_tls_hshake" -- "conf_legacy" /* DROWN */
	"conf_tls_hshake" -- "conf_mitm" /* 3SHAKE HSTS_not_preloaded */

### legacy subtree
	"conf_legacy" -- "conf_sniffing" /* DROWN */

##### sniffing subtree
	"conf_sniffing" -- "conf_drown_1" [lhead=cluster_drown] /* DROWN */

#### MITM subtree
	"conf_mitm" -- "conf_3shake_1" [lhead=cluster_3shake]/* 3SHAKE */
	"conf_mitm" -- "conf_stripping_1" [lhead=cluster_stripping] /* HSTS_not_preloaded */

#-----------Subgraphs-----------

	subgraph cluster_drown {
		label="DROWN";
		"conf_drown_1" -- "conf_drown_2" [style=invis];
	}
	subgraph cluster_3shake {
		label="3SHAKE";
		"conf_3shake_1" -- "conf_3shake_2" [style=invis];
	}
	subgraph cluster_stripping {
		label="SSL stripping";
		"conf_stripping_1" -- "conf_stripping_2" [style=invis];
	}

#################Integrity Nodes#################
##----------Parents---------
"int_msg_I" [label = "Break\nmessage integrity"][penwidth=4] /* RENEGOTIATION */
"int_tls_hshake" [label = "Exploit\nHandshake protocol"][penwidth=2] /* RENEGOTIATION */
"int_mitm" [label = "MITM"] /* RENEGOTIATION */

##----------Leaves----------
"int_reneg_1" [label = "- Renegotiation enabled"][color=chocolate]
"int_reneg_2" [label = "1. Intercept the victim's ClientHello\l2. Perform a full handshake with\l     the server\l3. Perform a privileged request\l4. Trigger a session renegotiation\l5. Send the original ClientHello to\l     the server\l"][color=deepskyblue2]

#-----------Edges-----------
## root
	"int_msg_I" -- "int_tls_hshake"  /* RENEGOTIATION */
	"int_tls_hshake" -- "int_mitm"  /* RENEGOTIATION */
	"int_mitm" -- "int_reneg_1" [lhead=cluster_renegotiation] /* RENEGOTIATION */

#-----------Subgraphs-----------

	subgraph cluster_renegotiation {
		label="Renegotiation attack";
		"int_reneg_1" -- "int_reneg_2" [style=invis];
	}	
}
